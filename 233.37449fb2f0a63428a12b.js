"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[233],{693:(t,e,s)=>{s.r(e),s.d(e,{default:()=>o});const a=s.p+"f000561d4f327acaf4e7.png";var n=s(988),i=s(211),r=s(820),l=s(240);class o extends r.Z{static#t="Проверка корреляции";static#e=a;static#s=null;static testText={pearson:"Тест Пирсона",spearman:"Тест Спирмена"};static altHypText={both:"Наличие корреляции (r ≠ 0)",right:"Положительная корреляция (r &#62; 0)",left:"Отрицательная корреляция (r &#60; 0)"};#a;#n={first:void 0,second:void 0};#i;#r={z:void 0,pearson:{r:void 0},spearman:{p:void 0}};#l;#o;#h;#c={first:void 0,second:void 0};#d;#p;#u;#m=[];#b=[];#v={pair:void 0};#_;#g;#f;constructor(t,e=null){super(),this.#a=t,e&&this.#y(e)}static setModuleTypeId(t){o.#s=t}static getModuleTypeId(){return o.#s}static getName(){return o.#t}static getImage(){return o.#e}deleteSelf(){uiControls.parametersContainer.removeChild(this.#p),uiControls.resultsContainer.removeChild(this.#g)}#y(t){const e=t.getAllData();this.#n=e.data,this.#i=e.power,this.#r=e.resultsTableData,this.#l=e.testType,this.#o=e.inputType,this.#h=e.altHypTest,this.#c=e.vars,this.#d=e.hypName;const s=e.element.cloneNode(!0),a=document.createElement("div");a.classList.add("results__block"),this.#T(s,a);const n=this.#p.querySelector("#module-option-form_"+e.id);n.setAttribute("id","module-option-form_"+this.#a),n.dataset.id=this.#a,[...this.#p.querySelectorAll(".form-change-trigger_"+e.id)].forEach((t=>{t.classList.replace("form-change-trigger_"+e.id,"form-change-trigger_"+this.#a),t.setAttribute("form","module-option-form_"+this.#a)})),uiControls.parametersContainer.insertBefore(this.#p,e.element.nextElementSibling),uiControls.resultsContainer.insertBefore(this.#g,e.resultBlock.nextElementSibling)}getAllData(t){const e={};return e.hypName=this.#d,e.inputType=this.#o,e.testType=this.#l,e.altHypTest=this.#h,e.resultsTableData=Object.deepCopy(this.#r),t?(e.moduleTypeId=o.#s,e.varIds=[this.#c.first?.getID(),this.#c.second?.getID()],e):(e.element=this.#p,e.resultBlock=this.#g,e.vars=Object.assign({},this.#c),e.power=this.#i,e.data=Object.assign({},this.#n),e.id=this.#a,e)}setName(t){this.#d=t,this.#p.querySelector(".parameters__title").textContent=t,this.#g.querySelector(".results__header").textContent=t}setId(t){const e=this.#a,s=this.#p.querySelector("#module-option-form_"+e);s.setAttribute("id","module-option-form_"+t),s.dataset.id=t,[...this.#p.querySelectorAll(".form-change-trigger_"+e)].forEach((s=>{s.classList.replace("form-change-trigger_"+e,"form-change-trigger_"+t),s.setAttribute("form","module-option-form_"+t)})),this.#a=t}setLoadingData(t,e,s,a,n){const i=(t,e)=>{[...this.#p.querySelector(".option-block__"+t).querySelectorAll("input")].forEach((t=>{t.value==e&&t.click()}))},r=(t,e)=>{const s=this.#p.querySelector(".option-block__"+t);e.forEach((t=>{const e=`input[name='${t[0]}']`,a=s.querySelector(e);a&&null!==t[1]&&void 0!==t[1]&&(a.value=t[1])}))};this.#o=t,this.#l=e,this.#h=s,this.#r=a,i("input-type",t),i("test-type",e),i("hyp-check",s);for(let t in this.#r)"z"!==t&&r(t,Object.entries(this.#r[t]));if("manual"===this.#o||!n[0]&&!n[1])return;const l=n[0].split("_"),o=n[1].split("_"),h=(t,e,s,a,n)=>{this.displayVarsOfSheet(t,e);s.querySelector(".var-table__item_"+a).click(),n.click()};h(l[1],"two-column-var",this.#_,n[0],this.#f),h(o[1],"two-column-var",this.#_,n[1],this.#f)}getName(){return this.#d}getElement(){return this.#p}getResultElement(){return this.#g}getFormSheets(){return this.#m}getSheetSelects(){return this.#b}setSheetOptions(t){let e="";for(let s of t){e+=`<option class='select-option-${s.id}' value="${s.id}">${s.name}</option>`}for(let t of this.#b)t.innerHTML=e}addSheetOptions(t){const e=[];for(let s of t)if(!this.#b[0].querySelector(`.select-option-${s.id}`)){const t=document.createElement("option");t.classList.add(`select-option-${s.id}`),t.value=s.id,t.textContent=s.name,e.push(t)}this.#b.forEach((t=>{const s=e.map((t=>t.cloneNode(!0)));t.append(...s)}))}addListeners(t){const e=this.#_,s=e.querySelector(".switch-button"),a=e.querySelector(".two-column-var__table-body"),i=e.querySelector(".target-table-data");this.#f=s;const r=()=>{2===i.children.length&&n.Z.setSettings(this.#a)};s.addEventListener("click",function(t,e,s,a){const n=t.querySelector("input:checked")||e.querySelector("input:checked");if(!n)return;const i=n.parentElement,l=i.parentElement;if(l.isSameNode(e))l.removeChild(i),((t,e)=>{const s=e.querySelector(".var-table__anchor_"+t.dataset.varId);s&&e.insertBefore(t,s)})(i,t),a.classList.replace("switch-button_left","switch-button_right");else{if(e.children.length===s)return;l.removeChild(i),e.appendChild(i),a.classList.replace("switch-button_right","switch-button_left")}r()}.bind(this,a,i,2,s))}displayVarsOfSheet(t,e){const s=i.Z.getVarsBySheetId(t);if(!s)return;let a,n=[];if("two-column-var"===e){a=this.#p.querySelector(".two-column-var__table-body");const t=this.#v.pair;n.push(t.firstElementChild?.dataset.varId),n.push(t.lastElementChild?.dataset.varId),a.innerHTML=function(){let t="";return s.forEach((e=>{const s=e.getID();let a=`\n                <label title="${e.getName()}" class="var-table__item var-table__item_${s}" data-var-id=${s}>\n                    <input type="radio" name="data_value">\n                    <img src=${e.getImg()} alt="${e.getTypeName()}" class="var-table__img">\n                    <span>${e.getName()}</span>\n                </label>`;n.includes(s)||(t+=a),t+=`<div class='var-table__anchor var-table__anchor_${s}'></div>`})),t}();const e=t=>{const e=this.#v.pair.firstElementChild,s=this.#v.pair.lastElementChild;e?.dataset.varId!==t.dataset.varId&&s?.dataset.varId!==t.dataset.varId?this.#f.classList.replace("switch-button_left","switch-button_right"):this.#f.classList.replace("switch-button_right","switch-button_left")};[...a.querySelectorAll(".var-table__item")].forEach((t=>t.querySelector("input").addEventListener("change",e.bind(this,t))))}}updateSelectedVarsVisual(t){(e=>{e.forEach((e=>{if(e){const s=e.dataset.varId.split("_");if(s[1]==t){const t=i.Z.getVarBySheetIdAndVarId(s[1],s[2]);if(!t)return void this.#v.pair.removeChild(e);const a=e.querySelector("img");e.querySelector("span").innerHTML=t.getName(),a.setAttribute("src",t.getImg()),a.setAttribute("alt",t.getTypeName())}}}))})([...this.#v.pair.querySelectorAll("label")])}clearSelectedVars(){this.#v.pair.innerHTML=""}createHTML(){const t="Гипотеза "+(this.#a+1),e=uiControls.parametersContainer,s=uiControls.resultsContainer,a=document.createElement("div"),n=document.createElement("div");a.classList.add("parameters__item","collapsible"),n.classList.add("results__block");const i=`\n        <label class="collapsible__head">\n            <input class="collapsible__input" type="checkbox" checked>\n            <div class="parameters__head">\n                <div class="parameters__title-container">\n                    <div class="collapsible__symbol collapsible__symbol_checked"></div>\n                    <h2 class="parameters__title">${t}</h2>\n                    <input class="parameters__title-input hidden" type='text'>\n                </div>\n                <div class="parameters__extra-container">\n                    <button title="Изменить название гипотезы"\n                        class="extra extra_edit-button main-button"></button>\n                    <label title="Убрать гипотезу из вычислений"\n                        class="extra extra_hide-button main-button">\n                        <input type="checkbox">\n                    </label>\n                    <button title="Дублировать гипотезу"\n                        class="extra extra_duplicate-button main-button"></button>\n                    <button title="Удалить гипотезу"\n                        class="extra extra_delete-button main-button"></button>\n                </div>\n            </div>\n        </label>\n        <div class="collapsible__content collapsible__content_checked">\n            <div class="parameters__content">\n                <form id="module-option-form_${this.#a}" class="module-option-form" data-id=${this.#a}></form>\n                <div class="option-block">\n                    <p>Метод проверки: Проверка корреляции</p>\n                    <div class="option-block__sub">\n                        Тип ввода\n                        <div class="option-block__list option-block__input-type">\n                            <label class="radio-line">\n                                <input class="main-radio form-change-trigger form-change-trigger_${this.#a} data-input-two" type="radio" name="input-type" value="data-input-two" form="module-option-form_${this.#a}"\n                                    checked>\n                                <span>Вычисление по данным (два столбца)</span>\n                            </label>\n                            <label class="radio-line">\n                                <input class="main-radio form-change-trigger form-change-trigger_${this.#a} manual-input-on" type="radio" name="input-type" value="manual" form="module-option-form_${this.#a}">\n                                <span>Ввести величину эффекта</span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class="option-block__two-column">\n                        <div class="option-block">\n                            <div class="option-block__sub">\n                                Тест\n                                <div class="option-block__list option-block__test-type">\n                                    <label class="radio-line">\n                                        <input class="main-radio form-change-trigger form-change-trigger_${this.#a}" type="radio"\n                                            name="test-type" value="pearson"\n                                            form="module-option-form_${this.#a}" checked>\n                                        <span>Пирсона</span>\n                                    </label>\n                                    <label class="radio-line">\n                                        <input class="main-radio form-change-trigger form-change-trigger_${this.#a}" type="radio"\n                                            name="test-type" value="spearman"\n                                            form="module-option-form_${this.#a}">\n                                        <span>Спирмена</span>\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="option-block">\n                            <div class="option-block__sub">\n                                Проверка альтернативной гипотезы\n                                <div class="option-block__list option-block__hyp-check">\n                                    <label class="radio-line">\n                                        <input class="main-radio form-change-trigger form-change-trigger_${this.#a}" type="radio"\n                                            name="hyp-check" value="both"\n                                            form="module-option-form_${this.#a}" checked>\n                                        <span>${o.altHypText.both}</span>\n                                    </label>\n                                    <label class="radio-line">\n                                        <input class="main-radio form-change-trigger form-change-trigger_${this.#a}" type="radio"\n                                            name="hyp-check" value="right"\n                                            form="module-option-form_${this.#a}">\n                                        <span>${o.altHypText.right}</span>\n                                    </label>\n                                    <label class="radio-line">\n                                        <input class="main-radio form-change-trigger form-change-trigger_${this.#a}" type="radio"\n                                            name="hyp-check" value="left"\n                                            form="module-option-form_${this.#a}">\n                                        <span>${o.altHypText.left}</span>\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="option-block__sub option-block__manual-input option-block__pearson option-block_hidden">\n                        Введите параметры:\n                        <div class="option-block__list">\n                            <label class="input-line">\n                                <span>Коэффициент корреляции Пирсона ( r ):</span>\n                                <input type="number" class="main-input main-input_number form-change-trigger form-change-trigger_${this.#a}" name="r" value="0.5" step="0.01" max="1" min="-1" form="module-option-form_${this.#a}">\n                            </label>\n                        </div>\n                    </div>\n                    <div class="option-block__sub option-block__manual-input option-block__spearman option-block_hidden">\n                        Введите параметры:\n                        <div class="option-block__list">\n                            <label class="input-line">\n                                <span>Коэффициент корреляции Спирмена ( &#961; ):</span>\n                                <input type="number" class="main-input main-input_number form-change-trigger form-change-trigger_${this.#a}" name="p" value="0.5" step="0.01" max="1" min="-1" form="module-option-form_${this.#a}">\n                            </label>\n                        </div>\n                    </div>\n                    \n                    <div class="option-block__tables two-column-var">\n                        <div class="var-table">\n                            <div class="var-table__header">\n                                <form class="sheet-form" data-type="two-column-var">\n                                    <div class="main-select">\n                                       <select class="main-input two-column-var__sheet-select sheet-select" name="sheet-select"></select>\n                                    </div>\n                                </form>\n                            </div>\n                            <div class="var-table__body two-column-var__table-body"></div>\n                        </div>\n                        <div class="two-column-var__switch-container">\n                            <div class="switch-button switch-button_right">\n                                <div class="switch-button__symbol"></div>\n                            </div>\n                        </div>\n                        <div class="var-table">\n                            <div class="var-table__header">Сравниваемые переменные</div>\n                            <div class="var-table__body two-column-var__table-body">\n                                <div class="two-column-var__item target-table-data">\n                                </div>\n                                <div class="two-column-var__delimiter"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`;a.innerHTML=i,this.#T(a,n),this.#d=t,e.appendChild(a),s.appendChild(n)}#T(t,e){this.#p=t,this.#u=t.querySelector(".module-option-form"),this.#m=[...t.querySelectorAll(".sheet-form")],this.#b=[...t.querySelectorAll(".sheet-select")],this.#v.pair=t.querySelector(".target-table-data"),this.#_=t.querySelector(".two-column-var"),this.#g=e}setSettings(){const t=new FormData(this.#u);switch(this.#l=t.get("test-type"),this.#h=t.get("hyp-check"),this.#o=t.get("input-type"),this.#l){case"pearson":"manual"===this.#o?this.#r.pearson.r=Number(t.get("r")):this.#r.pearson.r=null;break;case"spearman":"manual"===this.#o?this.#r.spearman.p=Number(t.get("p")):this.#r.spearman.p=null}this.#r.z=null;const e=[];this.#n.first=null,this.#n.second=null;const s=[];if(this.#c.first=null,this.#c.second=null,"manual"!==this.#o){const t=this.#v;let a,n;"data-input-two"===this.#o&&(a=[...t.pair.children],n=2===a.length),n&&(a.forEach((t=>{const a=t.dataset.varId.split("_");e.push(i.Z.getDataBySheetAndVarId(a[1],a[2])),s.push(i.Z.getVarBySheetIdAndVarId(a[1],a[2]))})),this.#n.first=e[0],this.#n.second=e[1],this.#c.first=s[0],this.#c.second=s[1])}}getN(t,e){return!t||Number.isNaN(t)||"number"!=typeof t?null:e&&!Number.isNaN(e)&&"number"==typeof e?this.#w(!1,t,e):void 0}setStatPower(t,e){if(!t||Number.isNaN(t)||"number"!=typeof t)return null;e&&!Number.isNaN(e)&&"number"==typeof e&&(this.#i=this.#w(!0,t,e))}#w(t,e,s){let a,n,i,r,o=[],h=[];if("manual"!==this.#o){if(!this.#n.first||!this.#n.second)return;if(a=this.#c.first.getTypeName(),n=this.#c.second.getTypeName(),"data-input-two"===this.#o){if(i=this.#v.pair,a!==n)return void uiControls.showError(i,"Нельзя сравнить данные разного типа");const t=Math.min(this.#n.first.length,this.#n.second.length);for(let e=0;e<t;e++){const t=this.#n.first[e],s=this.#n.second[e];""!==t&&""!==s&&(o.push(t),h.push(s))}}if(0===o.length||0===h.length)return void uiControls.showError(i,"Присутствует пустая выборка, невозможно провести вычисления")}else i=this.#p;try{switch(this.#l){case"pearson":if("manual"!==this.#o&&a!==l.Z.Continues.name)throw new Error(c([l.Z.Continues.ruName]));r=t?this.#k(e,s,o,h):this.#S(e,s,o,h);break;case"spearman":if("manual"!==this.#o&&a!==l.Z.Rang.name)throw new Error(c([l.Z.Rang.ruName]));if("manual"!==this.#o&&(this.#c.first.isUnited()||this.#c.second.isUnited()))throw new Error("Для данного теста переменные не должны находится в объединении с другими переменными");r=t?this.#$(e,s,o,h):this.#N(e,s,o,h)}}catch(t){return void uiControls.showError(i,t.message)}return r;function c(t){return`Выбранный тест поддерживает следующий тип данных: ${t.join(", ")}`}}#S(t,e,s,a){let n;const i=Math.getZAlpha(this.#h,t),r=Math.getZ(i,e);if("manual"===this.#o)n=this.#r.pearson.r;else{const t=Math.mean(s),e=Math.mean(a),i=[],r=[];for(let n=0;n<s.length;n++)i.push(s[n]-t),r.push(a[n]-e);const l=0,o=i.reduce(((t,e,s)=>t+e*r[s]),l),h=i.reduce(((t,e)=>t+e**2),l),c=r.reduce(((t,e)=>t+e**2),l);n=o/Math.sqrt(h*c),this.#r.pearson.r=n}this.#r.z=r;const l=(r/Math.fisher(n))**2+3;if(void 0===l||"number"!=typeof l)throw new Error("Ошибка расчета данных");return l}#k(t,e,s,a){let n,i;const r=Math.getZAlpha(this.#h,t);if("manual"===this.#o)n=this.#r.pearson.r;else{const t=Math.mean(s),e=Math.mean(a),i=[],r=[];for(let n=0;n<s.length;n++)i.push(s[n]-t),r.push(a[n]-e);const l=0,o=i.reduce(((t,e,s)=>t+e*r[s]),l),h=i.reduce(((t,e)=>t+e**2),l),c=r.reduce(((t,e)=>t+e**2),l);n=o/Math.sqrt(h*c),this.#r.pearson.r=n}i=Math.fisher(n)*Math.sqrt(e-3),i>0&&(i*=-1),this.#r.z=i;const l=i-r,o=100-Math.normdist(l);if(void 0===o||"number"!=typeof o)throw new Error("Ошибка расчета данных");return o}#N(t,e,s,a){let n;const i=Math.getZAlpha(this.#h,t),r=Math.getZ(i,e);if("manual"===this.#o)n=this.#r.spearman.p;else{const t=Math.rank.avg(s,this.#c.first.getOrderOfVal.bind(this.#c.first)),e=Math.rank.avg(a,this.#c.second.getOrderOfVal.bind(this.#c.second)),i=(s.length+1)/2,r=(a.length+1)/2,l=[],o=[];for(let n=0;n<s.length;n++)l.push(t.get(s[n])-i),o.push(e.get(a[n])-r);const h=0,c=l.reduce(((t,e,s)=>t+e*o[s]),h),d=l.reduce(((t,e)=>t+e**2),h),p=o.reduce(((t,e)=>t+e**2),h);n=c/Math.sqrt(d*p),this.#r.spearman.p=n}this.#r.z=r;const l=1.06*(r/Math.fisher(n))**2+3;if(void 0===l||"number"!=typeof l)throw new Error("Ошибка расчета данных");return l}#$(t,e,s,a){let n,i;const r=Math.getZAlpha(this.#h,t);if("manual"===this.#o)n=this.#r.spearman.p;else{const t=Math.rank.avg(s,this.#c.first.getOrderOfVal.bind(this.#c.first)),e=Math.rank.avg(a,this.#c.second.getOrderOfVal.bind(this.#c.second)),i=(s.length+1)/2,r=(a.length+1)/2,l=[],o=[];for(let n=0;n<s.length;n++)l.push(t.get(s[n])-i),o.push(e.get(a[n])-r);const h=0,c=l.reduce(((t,e,s)=>t+e*o[s]),h),d=l.reduce(((t,e)=>t+e**2),h),p=o.reduce(((t,e)=>t+e**2),h);n=c/Math.sqrt(d*p),this.#r.spearman.p=n}i=Math.fisher(n)*Math.sqrt((e-3)/1.06),i>0&&(i*=-1),this.#r.z=i;const l=i-r,o=100-Math.normdist(l);if(void 0===o||"number"!=typeof o)throw new Error("Ошибка расчета данных");return o}updateResultsHtml(t){const e=this.#d,s=t?"<p><b>Основная гипотеза</b></p>":`<p>Статистическая мощность: ${Number.resultForm(this.#i)}%</p>`;let a,n;"manual"===this.#o?n="\n            <th>\n            </th>\n            <th>\n            </th>":"data-input-two"===this.#o&&(n="\n            <th>\n                Выборка 1\n            </th>\n            <th>\n                Выборка 2\n            </th>"),"pearson"===this.#l?a=`<thead>\n                        <tr>\n                            ${n}\n                            <th>\n                                r\n                            </th>\n                            <th>\n                                z\n                            </th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            <td>\n                                ${String.resultForm(this.#c.first?.getName())}\n                            </td>\n                            <td>\n                                ${String.resultForm(this.#c.second?.getName())}\n                            </td>\n                            <td>\n                                ${Number.resultForm(this.#r.pearson.r)}\n                            </td>\n                            <td>\n                                ${Number.resultForm(this.#r.z)}\n                            </td>\n                        </tr >\n                    </tbody >`:"spearman"===this.#l&&(a=`<thead>\n                        <tr>\n                            ${n}\n                            <th>\n                                &#961;\n                            </th>\n                            <th>\n                                z\n                            </th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            <td>\n                                ${String.resultForm(this.#c.first?.getName())}\n                            </td>\n                            <td>\n                                ${String.resultForm(this.#c.second?.getName())}\n                            </td>\n                            <td>\n                                ${Number.resultForm(this.#r.spearman.p)}\n                            </td>\n                            <td>\n                                ${Number.resultForm(this.#r.z)}\n                            </td>\n                        </tr >\n                    </tbody >`);const i=`\n        <h2 class="results__header">${e}</h2>\n        <div class="results__block-inner">\n            ${s}\n            <p>Проверка корреляции</p>\n            <p>${o.testText[this.#l]}</p>\n            ${o.altHypText[this.#h]}\n            <table class="results__table">\n                <caption><small>${"manual"===this.#o?"Данные введены вручную":""}</small>\n                </caption>\n                ${a}\n            </table >\n        </div > `;this.#g.innerHTML=i}changeVisibilityResultsHtml(t){this.#g.style.display=t?"none":""}}}}]);